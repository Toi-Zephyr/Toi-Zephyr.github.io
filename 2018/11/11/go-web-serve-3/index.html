<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Zephyr"><title>mux 源码分析及性能对比 · 迷楼</title><meta name="description" content="使用 Go 编写 web 后台服务 —— 系列文章之三

本系列文章分为三部分。

初试Go服务 —— 入门了解使用 Go 编写一个简单的 web 服务器，即「Hello World」程序。
GoWeb 小应用 —— 进阶了解 go 服务编程的种种细节。
mux 源码分析及性能对比 —— 阅读 mu"><meta name="keywords" content="blog"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">後は野となれ山となれ</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">見ぬが花</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">首頁</a></li><li><a href="/archives">歸檔</a></li><li><a href="/categories">分類</a></li><li><a href="/tags">標籤</a></li><li><a href="/404.html">404</a></li><li><a href="/about/index.html">關於</a></li><li class="soc"><a href="https://github.com/Zophyr" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2019&nbsp;<a target="_blank" href="http://zophyr.com" rel="noopener noreferrer">Zephyr</a></p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>mux 源码分析及性能对比</a></p><p class="post-meta"><span class="date meta-item">發佈於&nbsp;2018-11-11</span><span class="meta-item"><i class="fa fa-folder"></i><span>&nbsp;</span><a href="/categories/教程/" title="教程" class="a-tag">教程</a><span>&nbsp;</span></span><span class="meta-item"><i class="fa fa-tag"></i><span>&nbsp;</span><a href="/tags/Go/" title="Go" class="a-tag">Go</a><span> / </span><a href="/tags/web/" title="web" class="a-tag">web</a><span> / </span><a href="/tags/后台服务/" title="后台服务" class="a-tag">后台服务</a><span> / </span><a href="/tags/源码阅读/" title="源码阅读" class="a-tag">源码阅读</a><span> / </span></span></p><p class="post-abstract"><blockquote>
<p>使用 Go 编写 web 后台服务 —— 系列文章之三</p>
</blockquote>
</p><p>本系列文章分为三部分。</p>
<ol>
<li><a href="https://zophyr.com/2018/11/11/go-web-serve-1/">初试Go服务</a> —— 入门了解使用 Go 编写一个简单的 web 服务器，即「Hello World」程序。</li>
<li>GoWeb 小应用 —— 进阶了解 go 服务编程的种种细节。</li>
<li><strong><a href="https://zophyr.com/2018/11/11/go-web-serve-3/">mux 源码分析及性能对比</a> —— 阅读 mux 的源码及分析对比各种由 go 编写的 http-routing 性能。</strong></li>
</ol>
<h2 id="Part-1-源码分析"><a href="#Part-1-源码分析" class="headerlink" title="Part 1. 源码分析"></a>Part 1. 源码分析</h2><h3 id="什么是-mux"><a href="#什么是-mux" class="headerlink" title="什么是 mux ?"></a>什么是 mux ?</h3><blockquote>
<p>A powerful URL router and dispatcher for golang. </p>
</blockquote>
<p>上述这段话是 <a href="https://github.com/gorilla/mux" target="_blank" rel="noopener">mux</a> 的简介。简单表述了什么是 mux ，一个强大的 URL 路由框架。</p>
<p>其出现是为了解决 golang 自带的 <code>http.SeverMux</code> 路由的缺陷：</p>
<ol>
<li><code>http.SeverMux</code> 不支持正则路由。</li>
<li><code>http.SeverMux</code> 只支持路径匹配，不支持按照Method，header，host等信息匹配，所以也就没法实现RESTful架构。</li>
</ol>
<h3 id="mux-go"><a href="#mux-go" class="headerlink" title="mux.go"></a>mux.go</h3><blockquote>
<p>mux 核心。</p>
</blockquote>
<p>一般用法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"net/http"</span></span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">    <span class="string">"github.com/gorilla/mux"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">YourHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    w.Write([]<span class="keyword">byte</span>(<span class="string">"Gorilla!\n"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := mux.NewRouter()</span><br><span class="line">    <span class="comment">// Routes consist of a path and a handler function.</span></span><br><span class="line">    r.HandleFunc(<span class="string">"/"</span>, YourHandler)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Bind to a port and pass our router in</span></span><br><span class="line">    log.Fatal(http.ListenAndServe(<span class="string">":8000"</span>, r))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>源码部分：</p>
<h4 id="func-NewRouter-Router"><a href="#func-NewRouter-Router" class="headerlink" title="func NewRouter() *Router"></a>func NewRouter() *Router</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NewRouter returns a new router instance.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewRouter</span><span class="params">()</span> *<span class="title">Router</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Router&#123;namedRoutes: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]*Route), KeepContext: <span class="literal">false</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>NewRouter为创建Router实例。</p>
</blockquote>
<h4 id="func-r-Router-ServeHTTP-w-http-ResponseWriter-req-http-Request"><a href="#func-r-Router-ServeHTTP-w-http-ResponseWriter-req-http-Request" class="headerlink" title="func (r Router) ServeHTTP(w http.ResponseWriter, req http.Request)"></a>func (r <em>Router) ServeHTTP(w http.ResponseWriter, req </em>http.Request)</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Router)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> !r.skipClean &#123;</span><br><span class="line">		path := req.URL.Path</span><br><span class="line">		<span class="keyword">if</span> r.useEncodedPath &#123;</span><br><span class="line">			path = req.URL.EscapedPath()</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// Clean path to canonical form and redirect.</span></span><br><span class="line">		<span class="keyword">if</span> p := cleanPath(path); p != path &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Added 3 lines (Philip Schlump) - It was dropping the query string and #whatever from query.</span></span><br><span class="line">			<span class="comment">// This matches with fix in go 1.2 r.c. 4 for same problem.  Go Issue:</span></span><br><span class="line">			<span class="comment">// http://code.google.com/p/go/issues/detail?id=5252</span></span><br><span class="line">			url := *req.URL</span><br><span class="line">			url.Path = p</span><br><span class="line">			p = url.String()</span><br><span class="line"></span><br><span class="line">			w.Header().Set(<span class="string">"Location"</span>, p)</span><br><span class="line">			w.WriteHeader(http.StatusMovedPermanently)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> match RouteMatch</span><br><span class="line">	<span class="keyword">var</span> handler http.Handler</span><br><span class="line">	<span class="keyword">if</span> r.Match(req, &amp;match) &#123;</span><br><span class="line">		handler = match.Handler</span><br><span class="line">		req = setVars(req, match.Vars)</span><br><span class="line">		req = setCurrentRoute(req, match.Route)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> handler == <span class="literal">nil</span> &amp;&amp; match.MatchErr == ErrMethodMismatch &#123;</span><br><span class="line">		handler = methodNotAllowedHandler()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> handler == <span class="literal">nil</span> &#123;</span><br><span class="line">		handler = http.NotFoundHandler()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> !r.KeepContext &#123;</span><br><span class="line">		<span class="keyword">defer</span> contextClear(req)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	handler.ServeHTTP(w, req)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> !r.skipClean &#123;</span><br><span class="line">    ···</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这部分是在对已经解释过的 flag 进行处理。</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> match RouteMatch</span><br><span class="line">    ······</span><br><span class="line">handler.ServeHTTP(w, req)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>余下这部分是在寻找匹配的路由，然后进入对应匹配路由所对应的 handler 。</p>
</blockquote>
<h4 id="func-r-Router-Match-req-http-Request-match-RouteMatch-bool"><a href="#func-r-Router-Match-req-http-Request-match-RouteMatch-bool" class="headerlink" title="func (r Router) Match(req http.Request, match *RouteMatch) bool"></a>func (r <em>Router) Match(req </em>http.Request, match *RouteMatch) bool</h4><p>我们看看是如何匹配路由的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Router)</span> <span class="title">Match</span><span class="params">(req *http.Request, match *RouteMatch)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> _, route := <span class="keyword">range</span> r.routes &#123;</span><br><span class="line">		<span class="keyword">if</span> route.Match(req, match) &#123;</span><br><span class="line">			<span class="comment">// Build middleware chain if no error was found</span></span><br><span class="line">			<span class="keyword">if</span> match.MatchErr == <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">for</span> i := <span class="built_in">len</span>(r.middlewares) - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">					match.Handler = r.middlewares[i].Middleware(match.Handler)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> match.MatchErr == ErrMethodMismatch &#123;</span><br><span class="line">		<span class="keyword">if</span> r.MethodNotAllowedHandler != <span class="literal">nil</span> &#123;</span><br><span class="line">			match.Handler = r.MethodNotAllowedHandler</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Closest match for a router (includes sub-routers)</span></span><br><span class="line">	<span class="keyword">if</span> r.NotFoundHandler != <span class="literal">nil</span> &#123;</span><br><span class="line">		match.Handler = r.NotFoundHandler</span><br><span class="line">		match.MatchErr = ErrNotFound</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	match.MatchErr = ErrNotFound</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>非常直接粗暴！直接遍历了routes，一个一个的去进行匹配，直到找到可以匹配上的。根据其简单的算法，我们可以发现这是具有一定的性能问题，会造成额外的性能开销。根据我们后面的性能测试中来看，mux 是具有一定的性能问题。</p>
</blockquote>
<h4 id="其余的为接口构建"><a href="#其余的为接口构建" class="headerlink" title="其余的为接口构建"></a>其余的为接口构建</h4><p>有常规和非常规，此处就不展开分析。</p>
<h3 id="Part-1-总结"><a href="#Part-1-总结" class="headerlink" title="Part 1. 总结"></a>Part 1. 总结</h3><p>mux 的源码是比较简单直接的。思路很清晰，通读几遍便可以了解该框架的整体构架与大体思路。</p>
<p>但是，也正是其简单直接的编写方式，并未用的什么高深巧妙的算法，所以其性能存在一定的问题。</p>
<p>而我们后面的性能测试，也证实了这一点。话不多说，我们进入性能比对部分。</p>
<h2 id="Part-2-性能比对"><a href="#Part-2-性能比对" class="headerlink" title="Part 2. 性能比对"></a>Part 2. 性能比对</h2><h3 id="Speedometer"><a href="#Speedometer" class="headerlink" title="Speedometer"></a>Speedometer</h3><blockquote>
<p>A go-http-routing benchmark</p>
</blockquote>
<p>为了进行性能测试，我们需要一个基准测试软件。</p>
<p>一开始我找到了名为「<a href="https://github.com/julienschmidt/go-http-routing-benchmark" target="_blank" rel="noopener">go-http-routing-benchmark</a>」的基准测试，但是其已经多年没有更新，而且按照 README 操作也并不能运行。所以参考该项目的核心代码，仿制了一个自己的 go-http-routing benchmark —— <a href="https://github.com/Zophyr/Speedometer" target="_blank" rel="noopener">Speedometer</a></p>
<h3 id="测试方法"><a href="#测试方法" class="headerlink" title="测试方法"></a>测试方法</h3><h4 id="安装-Speedometer"><a href="#安装-Speedometer" class="headerlink" title="安装 Speedometer"></a>安装 Speedometer</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go get -u github.com/Zophyr/Speedometer</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️ 该步骤可能会需要较多的时间，请耐心等待。</p>
</blockquote>
<h4 id="运行-Speedometer"><a href="#运行-Speedometer" class="headerlink" title="运行 Speedometer"></a>运行 Speedometer</h4><p>1.进入 Speedometer 文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/Zophyr/Speedometer</span></span><br></pre></td></tr></table></figure>
<p>2.执行 Speedometer 测试</p>
<p><strong>测试所有 router</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span> -bench=.</span></span><br></pre></td></tr></table></figure>
<p><strong>测试部分 router</strong></p>
<blockquote>
<p>eg. 测试 Martini &amp; Gin &amp; GorillaMux</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span> -bench=<span class="string">"Martini|Gin|GorillaMux"</span></span></span><br></pre></td></tr></table></figure>
<p><strong><em>更详尽介绍 <a href="https://github.com/Zophyr/Speedometer" target="_blank" rel="noopener">Speedometer</a></em></strong></p>
<h4 id="测试结果-Gin-VS-GorillaMux"><a href="#测试结果-Gin-VS-GorillaMux" class="headerlink" title="测试结果 Gin VS GorillaMux"></a>测试结果 <strong><em>Gin</em></strong> VS <strong><em>GorillaMux</em></strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">GithubAPI Routes: 203</span></span><br><span class="line">   Gin: 52064 Bytes</span><br><span class="line">   GorillaMux: 1329248 Bytes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">GPlusAPI Routes: 13</span></span><br><span class="line">   Gin: 3936 Bytes</span><br><span class="line">   GorillaMux: 66544 Bytes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ParseAPI Routes: 26</span></span><br><span class="line">   Gin: 6912 Bytes</span><br><span class="line">   GorillaMux: 106632 Bytes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">Static Routes: 157</span></span><br><span class="line">   Gin: 30480 Bytes</span><br><span class="line">   GorillaMux: 591136 Bytes</span><br><span class="line"></span><br><span class="line">goos: darwin</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: github.com/Zophyr/Speedometer</span><br><span class="line">BenchmarkGin_Param               	20000000	        65.3 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_Param        	  500000	      3135 ns/op	    1280 B/op	      10 allocs/op</span><br><span class="line">BenchmarkGin_Param5              	20000000	       120 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_Param5       	  300000	      4793 ns/op	    1344 B/op	      10 allocs/op</span><br><span class="line">BenchmarkGin_Param20             	 5000000	       304 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_Param20      	  200000	     10554 ns/op	    3452 B/op	      12 allocs/op</span><br><span class="line">BenchmarkGin_ParamWrite          	10000000	       153 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_ParamWrite   	  500000	      3363 ns/op	    1280 B/op	      10 allocs/op</span><br><span class="line">BenchmarkGin_GithubStatic        	20000000	        93.2 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_GithubStatic 	  100000	     17749 ns/op	     976 B/op	       9 allocs/op</span><br><span class="line">BenchmarkGin_GithubParam         	10000000	       161 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_GithubParam  	  200000	     10595 ns/op	    1296 B/op	      10 allocs/op</span><br><span class="line">BenchmarkGin_GithubAll           	   50000	     29143 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_GithubAll    	     300	   5387694 ns/op	  251648 B/op	    1994 allocs/op</span><br><span class="line">BenchmarkGin_GPlusStatic         	20000000	        66.4 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_GPlusStatic  	 1000000	      2345 ns/op	     976 B/op	       9 allocs/op</span><br><span class="line">BenchmarkGin_GPlusParam          	20000000	        87.5 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_GPlusParam   	  300000	      4127 ns/op	    1280 B/op	      10 allocs/op</span><br><span class="line">BenchmarkGin_GPlus2Params        	20000000	       116 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_GPlus2Params 	  200000	      7711 ns/op	    1296 B/op	      10 allocs/op</span><br><span class="line">BenchmarkGin_GPlusAll            	 1000000	      1248 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_GPlusAll     	   20000	     65454 ns/op	   16112 B/op	     128 allocs/op</span><br><span class="line">BenchmarkGin_ParseStatic         	20000000	        72.6 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_ParseStatic  	  300000	      3825 ns/op	     976 B/op	       9 allocs/op</span><br><span class="line">BenchmarkGin_ParseParam          	20000000	        76.3 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_ParseParam   	  500000	      3729 ns/op	    1280 B/op	      10 allocs/op</span><br><span class="line">BenchmarkGin_Parse2Params        	20000000	        91.3 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_Parse2Params 	  500000	      3946 ns/op	    1296 B/op	      10 allocs/op</span><br><span class="line">BenchmarkGin_ParseAll            	 1000000	      2134 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_ParseAll     	   10000	    127993 ns/op	   30288 B/op	     250 allocs/op</span><br><span class="line">BenchmarkGin_StaticAll           	  100000	     19305 ns/op	       0 B/op	       0 allocs/op</span><br><span class="line">BenchmarkGorillaMux_StaticAll    	    1000	   1645517 ns/op	  153328 B/op	    1421 allocs/op</span><br><span class="line">PASS</span><br><span class="line">ok  	github.com/Zophyr/Speedometer	59.501s</span><br></pre></td></tr></table></figure>
<h3 id="Part-2-总结"><a href="#Part-2-总结" class="headerlink" title="Part 2. 总结"></a>Part 2. 总结</h3><p>不出我们的意料，Gin 完胜 GorillaMux。</p>
<p></p></div><div class="share"><span>分享到</span>&nbsp;<span class="soc"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></span><span class="soc"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></span><span class="soc"><a href="http://twitter.com/home?status=http://zophyr.com/2018/11/11/go-web-serve-3/%20迷楼%20mux 源码分析及性能对比" class="fa fa-twitter"></a></span></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/2018/11/20/dapp-learning-1/" title="Dapp 开发学习（未完成）"><i class="fa fa-angle-double-left"></i>&nbsp;上一篇: Dapp 开发学习（未完成）</a></span><span> / </span><span class="next pagbuttons"><a role="navigation" href="/2018/11/11/go-web-serve-1/" title="初试 Go 服务">下一篇: 初试 Go 服务&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2019&nbsp;<a target="_blank" href="http://zophyr.com" rel="noopener noreferrer">Zephyr</a></p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>